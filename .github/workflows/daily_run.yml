name: Daily Subsidy Data Update

on:
  schedule:
    - cron: '0 0 * * *' # 日本時間 午前9時 (UTC 0:00)
  workflow_dispatch: # 手動実行用

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Run script with error handling and logs
        env:
          AIRTABLE_API_KEY: ${{ secrets.AIRTABLE_API_KEY }} # 秘密度が高い値はSecretから
          AIRTABLE_BASE_ID: ${{ secrets.AIRTABLE_BASE_ID }}
        run: |
          python -c "
          import os
          import datetime
          import sys

          def run_update():
              try:
                  # 1. 依存関係と環境変数のチェック
                  print(f'[{datetime.datetime.now()}] Starting daily run...')
                  api_key = os.environ.get('AIRTABLE_API_KEY')
                  if not api_key:
                      raise ValueError('Missing AIRTABLE_API_KEY')
                  print('Check: API Key found.')

                  # 2. 物理定数・単位のシミュレーション（例：補助金額の計算など）
                  # 計算工程を追跡可能にする
                  raw_value = 100000 # SI単位系（円）
                  tax_rate = 0.1
                  final_value = raw_value * (1 + tax_rate)
                  print(f'Calculation Step: {raw_value} * (1 + {tax_rate}) = {final_value}')

                  # 3. 実行メイン（実際のスクリプト呼び出し）
                  # ここに main.py 等の実行コードを記述
                  print('Main process completed successfully.')

              except Exception as e:
                  print(f'Error occurred: {str(e)}')
                  sys.exit(1) # 失敗をGitHub Actionsに通知

          run_update()
          "
